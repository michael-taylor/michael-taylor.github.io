{{- $params := partial "function/params.html" -}}

{{- /*  Git info  */ -}}
{{- $gitRepo := "" -}}
{{- $blobURL := "" -}}
{{- $sourceURL := "" -}}
{{- $editURL := "" -}}
{{- $reportURL := "" -}}
{{- with .Site.Params.gitInfo -}}
  {{- if .Repo -}}
    {{- $gitRepo = strings.TrimSuffix "/" .Repo -}}
    {{- $blobURL = printf "%v/blob/%v/%v/{path}" $gitRepo .Branch .Dir -}}
    {{- $editURL = printf "%v/edit/%v/%v/{path}" $gitRepo .Branch .Dir -}}
    {{- $reportURL = printf "%v/issues/new?%v" $gitRepo .IssueTpl -}}
  {{- end -}}
{{- end -}}

<div class="post-footer" id="post-footer">
  <div class="post-info">
    <div class="post-info-line">
      <div class="post-info-mod">
        {{- $updateTitle := dict "Date" ("2006-01-02 15:04:05" | .Lastmod.Format) | T "single.updatedOnDate" -}}
        <span title="{{ $updateTitle }}">
          {{- with .Lastmod | dateFormat (.Site.Params.dateformat | default "2006-01-02") -}}
            {{- dict "Date" . | T "single.updatedOnDate" -}}&nbsp;
            {{- if $gitRepo -}}
              {{- with $.GitInfo -}}
                {{- $title := printf "%v&#10%v&#10Commit: %v [%v]&#10Author: %v<%v>&#10Date: %v" .Subject .Body .Hash .AbbreviatedHash .AuthorName .AuthorEmail (.AuthorDate | dateFormat "2006-01-02 15:04:05") -}}
                {{- if ne .AuthorDate .CommitDate -}}
                  {{- $title = printf "%s&#10Commit Date: %v" $title (.CommitDate | dateFormat "2006-01-02 15:04:05") -}}
                {{- end -}}
                <a class="git-hash" href="{{ printf `%v/commit/%v` $gitRepo .Hash }}" rel="external nofollow noopener noreferrer" target="_blank" title="{{ $title | safeHTML }}">
                  {{- dict "Class" "fa-solid fa-hashtag fa-fw" | partial "plugin/icon.html" -}}
                  {{- .AbbreviatedHash -}}
                </a>
              {{- end -}}
            {{- end -}}
          {{- end -}}
        </span>
      </div>
    </div>
    <div>
      <div class="post-info-share">
        <span>
          {{- partial "plugin/share.html" . -}}
        </span>
      </div>
    </div>
  </div>

  <div class="post-info-more">
    <section class="post-tags">
      {{- $tagTerms := .GetTerms "tags" -}}
      {{- if $tagTerms -}}
        {{- dict "Class" "fa-solid fa-tags fa-fw me-1" | partial "plugin/icon.html" -}}
        {{- range $tagTerms -}}
          {{- $href := partial "function/escapeurl.html" .RelPermalink -}}
          {{- $title := printf "%v - %v" (T "tags") .LinkTitle -}}
          <a href="{{ $href }}" class="post-tag" title="{{ $title }}">{{ .LinkTitle }}</a>
        {{- end -}}
      {{- end -}}
    </section>
  </div>

  {{- $navigation := .Site.Params.navigation -}}
  <div class="post-nav">
    {{- $pages := .Site.Store.Get "mainSectionPages" -}}
    {{- $prev := $pages.Prev . -}}
    {{- $next := $pages.Next . -}}
    {{- /* Show the post navigation in section pages */ -}}
    {{- if $navigation.inSection -}}
      {{- $prev = .PrevInSection -}}
      {{- $next = .NextInSection -}}
    {{- end -}}
    {{- /* Reverse the next/previous post navigation order */ -}}
    {{- if $navigation.reverse -}}
      {{- $prev = $pages.Next . -}}
      {{- $next = $pages.Prev . -}}
    {{- end -}}
    {{- with $prev -}}
      {{- $capitalizeTitles := .Param "capitalizeTitles" -}}
      <a href="{{ .RelPermalink }}" class="post-nav-item" rel="prev" title="{{ cond $capitalizeTitles (title .LinkTitle) .LinkTitle }}">
        {{- dict "Class" "fa-solid fa-angle-left fa-fw" | partial "plugin/icon.html" -}}
        {{- cond $capitalizeTitles (title .LinkTitle) .LinkTitle -}}
      </a>
    {{- end -}}
    {{ with $next }}
      {{- $capitalizeTitles := .Param "capitalizeTitles" -}}
      <a href="{{ .RelPermalink }}" class="post-nav-item" rel="next" title="{{ cond $capitalizeTitles (title .LinkTitle) .LinkTitle }}">
        {{- cond $capitalizeTitles (title .LinkTitle) .LinkTitle -}}
        {{- dict "Class" "fa-solid fa-angle-right fa-fw" | partial "plugin/icon.html" -}}
      </a>
    {{- end -}}
  </div>
</div>
